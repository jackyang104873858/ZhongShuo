<!DOCTYPE HTML>
<html>
<head>
<title>发表新文章</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Modern Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
 <!-- Bootstrap Core CSS -->
<link href="../styles/bootstrap.min.css" rel='stylesheet' type='text/css' />
<!-- Custom CSS -->
<link href="../styles/bg/style.css" rel='stylesheet' type='text/css' />
<link href="../styles/bg/font-awesome.css" rel="stylesheet"> 
<link rel="stylesheet" type="text/css" href="../styles/ueditor/ueditor.css">
<link rel="stylesheet" type="text/css" href="../styles/tinybox.css">
<!-- jQuery -->
<script src="../js/jquery.min.js"></script>
<!----webfonts--->
<link href='http://fonts.useso.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet' type='text/css'>
<!---//webfonts--->  
<!-- Bootstrap Core JavaScript -->
<script src="../js/bootstrap.min.js"></script>
<script src="../js/upload.js" type="text/javascript"></script>
<style>
.uploadBtn{
                display:inline-block; 
                position:relative; 
                overflow:hidden;
            }
.fileUpload{
                position:absolute; 
                right:0; 
                top:0; 
                font-size:100px; 
                opacity:0; 
                filter:alpha(opacity=0);
            }
</style>
</head>
<body>
<div id="wrapper">
     <!-- Navigation -->
        <nav class="top1 navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">众说</a>
            </div>
            <!-- /.navbar-header -->
            <ul class="nav navbar-nav navbar-right">
				<li class="dropdown">
	        		<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-comments-o"></i><span class="badge">4</span></a>
	        		<ul class="dropdown-menu">
						<li class="dropdown-menu-header">
							<strong>Messages</strong>
							<div class="progress thin">
							  <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
							    <span class="sr-only">40% Complete (success)</span>
							  </div>
							</div>
						</li>
						<li class="avatar">
							<a href="#">
								<img src="images/1.png" alt=""/>
								<div>New message</div>
								<small>1 minute ago</small>
								<span class="label label-info">NEW</span>
							</a>
						</li>
						<li class="avatar">
							<a href="#">
								<img src="images/2.png" alt=""/>
								<div>New message</div>
								<small>1 minute ago</small>
								<span class="label label-info">NEW</span>
							</a>
						</li>
						<li class="avatar">
							<a href="#">
								<img src="images/3.png" alt=""/>
								<div>New message</div>
								<small>1 minute ago</small>
							</a>
						</li>
						<li class="avatar">
							<a href="#">
								<img src="images/4.png" alt=""/>
								<div>New message</div>
								<small>1 minute ago</small>
							</a>
						</li>
						<li class="avatar">
							<a href="#">
								<img src="images/5.png" alt=""/>
								<div>New message</div>
								<small>1 minute ago</small>
							</a>
						</li>
						<li class="avatar">
							<a href="#">
								<img src="images/pic1.png" alt=""/>
								<div>New message</div>
								<small>1 minute ago</small>
							</a>
						</li>
						<li class="dropdown-menu-footer text-center">
							<a href="#">View all messages</a>
						</li>	
	        		</ul>
	      		</li>
			    <li class="dropdown">
	        		<a href="#" class="dropdown-toggle avatar" data-toggle="dropdown"><img src="images/1.png" alt=""/><span class="badge">9</span></a>
	        		<ul class="dropdown-menu">
						<li class="dropdown-menu-header text-center">
							<strong>Account</strong>
						</li>
						<li class="m_2"><a href="#"><i class="fa fa-bell-o"></i> Updates <span class="label label-info">42</span></a></li>
						<li class="m_2"><a href="#"><i class="fa fa-envelope-o"></i> Messages <span class="label label-success">42</span></a></li>
						<li class="m_2"><a href="#"><i class="fa fa-tasks"></i> Tasks <span class="label label-danger">42</span></a></li>
						<li><a href="#"><i class="fa fa-comments"></i> Comments <span class="label label-warning">42</span></a></li>
						<li class="dropdown-menu-header text-center">
							<strong>Settings</strong>
						</li>
						<li class="m_2"><a href="#"><i class="fa fa-user"></i> Profile</a></li>
						<li class="m_2"><a href="#"><i class="fa fa-wrench"></i> Settings</a></li>
						<li class="m_2"><a href="#"><i class="fa fa-usd"></i> Payments <span class="label label-default">42</span></a></li>
						<li class="m_2"><a href="#"><i class="fa fa-file"></i> Projects <span class="label label-primary">42</span></a></li>
						<li class="divider"></li>
						<li class="m_2"><a href="#"><i class="fa fa-shield"></i> Lock Profile</a></li>
						<li class="m_2"><a href="#"><i class="fa fa-lock"></i> Logout</a></li>	
	        		</ul>
	      		</li>
			</ul>
			<form class="navbar-form navbar-right">
              <input type="text" class="form-control" value="Search..." onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Search...';}">
            </form>
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="index"><i class="fa fa-dashboard fa-fw nav_icon"></i>首页</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-indent nav_icon"></i>文章管理<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="newArticle">写新文章</a>
                                </li>
                                <li>
                                    <a href="myArticle">我的文章</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>
        <div id="page-wrapper">
        <div class="graphs">
        <div class="col-md-12">
        	<div class="Compose-Message">               
                <div class="panel panel-default">
                    <div class="panel-heading">
                        发表新文章
                    </div>
                    <div class="panel-body">
                            <label>标题 : </label>
                            <input type="text" class="form-control1 control3" id="title" name="title">
                            <label>作者 :  </label>
                            <input type="text" class="form-control1 control3" id="author" name="author">
                            <label>封面（大图片建议尺寸：900像素 * 500像素） :  </label>
                            <br />
                            <a href="javascript:void(0)" class="btn btn-warning uploadBtn" id="btnUpload"><span class="glyphicon glyphicon-tags tag_01"></span> 本地上传<input type="file" accept="image/*;capture=camera" class="fileUpload"></a>
                            <input type="hidden" id="cover" name="cover" />
                            <br />
                            <div id="divCover" style="display:none;">
                                <img id="imgCover" style="max-width:180px; max-height:100px;" />
                                <button type="button" class="btn btn-link" id="btnDelCover">删除</button>
                            </div>
                            <div class="checkbox-inline1">
                                <label><input type="checkbox" checked id="cbCover"/>封面图片显示在正文中</label>
                            </div>
                            <br />
                            <label>摘要（选填） : </label>
                            <textarea class="form-control1 control2" id="desc" name="desc"></textarea>
                            <label>正文 : </label>
                            <!-- 加载编辑器的容器 -->
                            <script id="container" name="content" type="text/plain">
                                
                            </script>
                            <!-- 配置文件 -->
                            <script type="text/javascript" src="../js/ueditor/ueditor.config.js"></script>
                            <!-- 编辑器源码文件 -->
                            <script type="text/javascript" src="../js/ueditor/ueditor.all.js"></script>
                            <script type="text/javascript" charset="utf-8" src="../js/ueditor/zh-cn.js"></script>
                            <!-- 实例化编辑器 -->
                            <script type="text/javascript">
                                var ue = UE.getEditor('container', {
                                  initialFrameHeight: 500,
                                  autoHeightEnabled: false
                                });
                            </script>
                            <hr>
                            <a href="javascript:saveContent()" class="btn btn-info" id="btnOK"><span class="glyphicon glyphicon-envelope tag_02"></span> 确定提交 </a>
                    </div>
                 </div>
              </div>
         </div>
         <div class="clearfix"> </div>
   </div>
    <div class="copy_layout">
         <p>Copyright &copy; 2015.Company name All rights reserved.<a target="_blank" href="http://sc.chinaz.com/moban/">&#x7F51;&#x9875;&#x6A21;&#x677F;</a></p>
       </div>
   </div>
      </div>
      <!-- /#page-wrapper -->
   </div>
    <!-- /#wrapper -->
<!-- Nav CSS -->
<link href="../styles/bg/custom.css" rel="stylesheet">
<!-- Metis Menu Plugin JavaScript -->
<script src="../js/bg/metisMenu.min.js"></script>
<script src="../js/bg/custom.js"></script>
<script type="text/javascript" src="../js/tinybox.js"></script>
<script type="text/javascript">
  function saveContent(){
    var title = $('#title').val();
    var author = $('#author').val();
    var cover = $('#cover').val();
    var desc = $('#desc').val();
    var content = ue.getContent();
    if(title == ''){
        $('html, body').animate({scrollTop:0}, 'slow');
        TINY.box.show({html:'请填写标题!',animate:false,close:false,boxid:'error',width:250});
        return;
    }
    else if(author == ''){
        $('html, body').animate({scrollTop:0}, 'slow');
        TINY.box.show({html:'请填写作者!',animate:false,close:false,boxid:'error',width:250});
        return;
    }
    else if(cover == ''){
        $('html, body').animate({scrollTop:0}, 'slow');
        TINY.box.show({html:'请上传封面!',animate:false,close:false,boxid:'error',width:250});
        return;
    }
    else if(content == ''){
        $('html, body').animate({scrollTop:0}, 'slow');
        TINY.box.show({html:'请填写正文!',animate:false,close:false,boxid:'error',width:250});
        return;
    }
    $('#btnOK').removeClass('btn-info').addClass('btn-danger').attr("disabled",true).text('提交中，请稍候……'); 
    $.ajax({
      url:'saveArticle',
      type: 'POST',
      cache: false,
      data: {
        title: title,
        author: author,
        cover: cover,
        desc: desc,
        content: content,
        isShowCover: $('#cbCover')[0].checked
      },
      success:function(ret){
        getPage('/static/' + ret);
      },
      error: function(req, status, err) {
            alert(req.responseText);
          }
    });
  }

    function getPage(url) {
        $.ajax({
            url: url,
            type: 'get',
            success: function(data) {
                $('html, body').animate({scrollTop:0}, 'slow');
                $('#btnOK').removeClass('btn-danger').addClass('btn-info').attr("disabled",false).html('span class="glyphicon glyphicon-envelope tag_02"></span> 确定提交 '); 
                TINY.box.show({html:'提交成功，<a href="'+url+'">点击此处</a>查看文章!',animate:false,close:false,boxid:'error',width:250});
            },
            error: function(data){
                getPage(url);
            }
        });
    }

    document.addEventListener('DOMContentLoaded', init, false); 

    function init() { 
        var u = new UploadPic(); 
        u.init({ 
            input: document.querySelector('.fileUpload'), 
            callback: function (base64) { 
                $('#btnUpload').removeClass('btn-warning').addClass('btn-danger').attr("disabled",true).text('上传中，请稍候……'); 
                $.ajax({ 
                    url:"/file/base64Handler", 
                    data:{str:base64,type:this.fileType,dir:'article'}, 
                    type:'post', 
                    dataType:'json', 
                    success:function(ret){ 
                        getCover(ret.src);
                    },
                    error: function(req, status, err) {
                        alert(req.responseText);
                    }
                }) 
        }, loading: function () { 
         
            }
        }); 
    } 

    function getCover(url) {
    $.ajax({
        url: url,
        type: 'get',
        success: function(data) {
            $('#imgCover').attr('src', url);
            $('#btnUpload').removeClass('btn-danger').addClass('btn-warning').attr("disabled",false).html('<span class="glyphicon glyphicon-tags tag_01"></span> 本地上传<input type="file" accept="image/*;capture=camera" class="fileUpload">'); 
            $('#divCover').fadeIn();
            $('#cover').val(url);
        },
        error: function(data){
            getCover(url);
        }
    });

    $(document).ready(function(){
        $('#btnDelCover').click(function(){
            $('#imgCover').attr('src', '');
            $('#divCover').fadeOut();
            $('#cover').val('');
            init();
        });
    });
}
</script>
</body>
</html>
